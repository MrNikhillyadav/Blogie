generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          String      @id @default(cuid())
  name        String?
  email       String?     @unique
  password    String?
  posts       Post[]
  comments    Comment[]
  votes       Vote[]
  bookmark    Bookmark[]
}

model Post {
  id            Int         @id @default(autoincrement())
  title         String?
  description   String?
  userId        String
  user          User        @relation(fields:[userId], references:[id])
  createdAt     DateTime    @default(now())
  slug          String
  image         String?
  comments      Comment[]
  bookmark      Bookmark[]
  votes         Vote[]
  commentsCount Int         @default(0) 

  @@index([userId])
}

model Comment {
  id            Int       @id @default(autoincrement())
  content       String
  postId        Int
  commentedOn   Post      @relation(fields:[postId], references:[id] )
  userId        String
  user          User      @relation(fields:[userId], references:[id])
  votes         Vote[]
  parentId      Int?
  parent        Comment?  @relation("CommentToComment", fields:[parentId], references:[id])
  children      Comment[] @relation("CommentToComment")
  upVotes       Int       @default(0)
  downVotes     Int       @default(0)
  repliesCount  Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt()
  
  @@index([postId])
  @@index([userId])
  @@index([parentId])
}

model Bookmark {
  id            Int       @id @default(autoincrement())
  postId        Int
  post          Post      @relation(fields:[postId], references:[id])
  userId        String
  user          User      @relation(fields:[userId], references:[id])
  createdAt     DateTime  @default(now())
}

model Vote {
  id            Int       @id @default(autoincrement())
  commentId     Int?
  comment       Comment?   @relation(fields:[commentId], references:[id])
  postId        Int?
  post          Post?    @relation(fields:[postId], references:[id])
  userId        String
  user          User      @relation(fields:[userId], references:[id])
  targetType    VoteTarget
  voteType      VoteType
  createdAt     DateTime  @default(now())
  
  @@unique([commentId,userId])
  @@unique([postId,userId])
  @@index([targetType])
}

enum  VoteType{
  UPVOTE
  DOWNVOTE
}

enum VoteTarget {
  POST
  COMMENT
}
